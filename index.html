<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml"> 
<head> 
<title>YoutubeCaster</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="icon.svg" />
<link rel="apple-touch-icon" sizes="128x128" href="https://youtubecaster.herokuapp.com/icon.svg">
<link rel="image_src" href="https://youtubecaster.herokuapp.com/icon.svg">
<meta property="og:image" content="https://youtubecaster.herokuapp.com/icon.svg">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> 
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">

<style>
body {
	font-family: Roboto, verdana;
	padding: 2px;
	margin:0;
	text-align: center;
	font-size: 20px;
	background: #fff;
	color:#333;
	overflow-x: hidden;
}
input {
	width: 80%;
	max-width: 700px;
	font-size: 25px;
	text-align: center;
	border-radius: 3px;
	border:1px solid #ccc;
	box-shadow: inset 1px 1px 2px #ddd;
	color: #aaa;
	background: #fff;	
}
input:focus {
	outline: none;
}
input:focus::placeholder {
	opacity: 0;
}
button {
	font-size: 25px;
	padding: 2px 10px;
	width: 100px;
	border: none;
	border-radius: 3px;
	background: #eee;
	color: #333;
	cursor: pointer;
}
a {
	text-decoration: none;
}
.modal {
	background: white;
	width: 80%;
	margin: 0 auto;
}
.playing {
	visibility: hidden;
}
ul {
	list-style: none;
	padding: 0;
	width: 100%;
	margin: 0 auto;
	clear: both;
	overflow-x: hidden;
}
li {
	list-style: none;
	margin: 4px 0;
	background: #efefef;
	cursor: pointer;
	clear: both;
	line-height: 60px;
	vertical-align: middle;
	white-space: nowrap;
	text-align: left;
	position: relative;
	height: 60px;
}
li .playing {
	visibility: hidden;
}
li.play {
	background:#fc1;
}
li.play .playing {
	visibility: visible;
}
li small {
	position: absolute;
	top:3px;
	right:3px;
	background:#fff;
	padding: 2px 4px;
	line-height: 16px;
	font-size: 14px;
	border-radius: 5px;
}
li span {
	overflow: hidden;
	text-overflow: ellipsis;
	width: 80%;
	display: inline-block;
}
li img {
	float: left;
	width: auto;
	height: 60px;
	margin-right: 5px;
}
li .bar {

}
#err {
	font-size: 14px;
	height: 14px;
	color: red;
	clear: both;
}
</style>
</head>

<body>
<div id="logo">
<svg xmlns="http://www.w3.org/2000/svg" width="350" height="100" xmlns:v="https://vecta.io/nano"><path d="M20.816 49.44c.802-3.2 3.152-5.618 6.132-6.524 5.444-1.5 27.22-1.5 27.22-1.5s21.775 0 27.22 1.5c2.98.846 5.33 3.322 6.132 6.524 1.433 5.738 1.433 17.638 1.433 17.638s0 11.96-1.433 17.638c-.86 3.2-3.152 5.678-6.2 6.524-5.387 1.5-27.162 1.5-27.162 1.5s-21.775 0-27.22-1.5c-2.98-.846-5.33-3.322-6.2-6.463-1.433-5.738-1.433-17.638-1.433-17.638s.057-11.96 1.5-17.698z" fill="red"/><path d="M116.497 86.97c-1.42-1.036-2.403-2.6-2.785-4.375a31.52 31.52 0 0 1-.819-7.828v-4.432c-.055-2.705.273-5.353.983-7.943.5-1.784 1.53-3.34 2.95-4.375 1.584-.98 3.44-1.44 5.297-1.38 2.13 0 3.877.46 5.188 1.38 1.365 1.094 2.403 2.6 2.84 4.375.655 2.6.983 5.238.874 7.943v4.432c.055 2.648-.218 5.296-.874 7.886-.437 1.784-1.42 3.28-2.84 4.375-1.3.92-3.113 1.38-5.35 1.38-2.293-.058-4.15-.518-5.46-1.44zm7.372-4.835c.382-.98.546-2.648.546-4.893v-9.497c.055-1.612-.1-3.28-.546-4.835-.218-.92-1.038-1.554-1.9-1.554s-1.638.633-1.857 1.554c-.437 1.554-.6 3.223-.546 4.835V77.3c0 2.245.164 3.914.546 4.893.218.92.983 1.554 1.9 1.497.874 0 1.638-.633 1.857-1.554zm93.432-7.3v1.554l.164 4.432c.055.748.273 1.497.7 2.13.437.46 1.038.748 1.638.7.82.058 1.638-.403 2.02-1.2s.546-2.13.6-4.03l5.625.403c.055.345.055.748.055 1.094 0 2.82-.7 4.95-2.184 6.332s-3.55 2.072-6.225 2.072c-3.222 0-5.46-1.094-6.77-3.223s-1.966-5.4-1.966-9.9v-5.353c0-4.605.655-7.943 2.02-10.073s3.66-3.166 6.88-3.166c2.24 0 3.986.46 5.188 1.324 1.256.98 2.184 2.418 2.567 4.03.546 2.475.82 5.065.7 7.598v5.238zm.82-12.894c-.382.633-.655 1.38-.655 2.13-.1 1.497-.164 2.993-.164 4.5v2.187h4.805V68.57c0-1.497-.055-2.993-.218-4.5-.055-.748-.273-1.497-.7-2.13a1.79 1.79 0 0 0-1.53-.633 1.73 1.73 0 0 0-1.529.633zm-117.57 12.3l-7.427-28.377h6.498l2.62 12.836c.655 3.166 1.147 5.87 1.474 8.116h.218c.218-1.612.7-4.26 1.474-8.058l2.73-12.894h6.498L107.1 74.25v13.642h-6.498V74.25zm51.604-17.038v30.68h-5.133l-.546-3.74h-.164c-1.365 2.82-3.495 4.26-6.28 4.26-1.9 0-3.33-.7-4.26-2.015S134.4 83 134.4 80.122v-22.9h6.553V79.72c-.055.98.1 2.015.437 2.936.273.576.82.92 1.42.863.6 0 1.147-.23 1.638-.576s.928-.806 1.147-1.38v-24.35zm33.583 0v30.68h-5.133l-.546-3.74h-.164c-1.365 2.82-3.495 4.26-6.28 4.26-1.9 0-3.33-.7-4.26-2.015S168 83.002 168 80.124v-22.9h6.553V79.72c-.055.98.1 2.015.437 2.936.273.576.82.92 1.42.863.6 0 1.147-.23 1.638-.576s.928-.806 1.147-1.38v-24.35zm-15.78-5.756h-6.498v36.436h-6.4V51.456h-6.498v-5.583h19.385zm37.47 10.65c-.382-1.9-1.038-3.34-1.9-4.202a5.17 5.17 0 0 0-3.659-1.324c-1.2 0-2.348.345-3.386 1.094-1.038.7-1.857 1.67-2.403 2.82h-.055V44.32h-6.28v43.573h5.406l.655-2.878h.164a5.75 5.75 0 0 0 2.293 2.475c1.038.576 2.184.92 3.386.92 2.075.058 4.04-1.2 4.915-3.223 1.038-2.13 1.584-5.526 1.584-10.073V70.28c-.055-2.82-.273-5.526-.7-8.174zm-6.007 12.5c0 1.727-.055 3.5-.273 5.238-.055.98-.382 1.9-.874 2.705-.382.518-.983.806-1.638.806-.546 0-1.038-.115-1.474-.403s-.82-.7-1.092-1.2V64.35a4.77 4.77 0 0 1 1.147-2.072c.437-.518 1.092-.806 1.747-.806.6 0 1.2.288 1.53.806a7.09 7.09 0 0 1 .764 2.763c.164 1.842.218 3.684.218 5.526zM24 7.228c-17.87 5.047-21.3 23.8-18.82 33.6 2.494.16 4.523.563 6.243 1.126-4.405 3.527.77 13.27 5.626 18.193.093 1.415.304 2.857.674 4.3 2.347 9.23 9.58 15.187 16.195 13.318 1.654-.467 3.125-1.365 4.343-2.616.017-.017.02-.05.036-.066 1.126-3.766 1.226-8.448.01-13.228-1.292-5.083-3.78-9.266-6.774-11.923-2.003-1.777-4.193-2.84-6.373-3.1-3.818-3.235-7.535-6.57-9.986-10.46C14 28.782 20.678 13.008 30 10.472c9.27-2.527 16.146 8.47 21.78 15.797a8.51 8.51 0 0 0-1.385 2.225c-.13.308-.232.657-.33.982-.62-.02-1.245.018-1.85.2-5.373 1.517-7.84 10.213-5.494 19.444s8.6 15.46 13.982 13.943c4.204-1.188 6.622-6.78 6.354-13.575 1.277-1.628 1.325-5.16.14-8.986.543-.646 1.02-1.373 1.35-2.16.862-2.058 1.015-4.5.382-6.998s-1.94-4.583-3.664-5.9-3.92-1.95-6.135-1.323c-.08.023-.166.043-.246.07-.2-5.274-1.6-9.602-3.52-13.843-9.456-5.53-15.844-6.36-27.36-3.108zM62.792 38.06c-.08.2-.197.35-.288.526-2.023-4.896-5.34-8.036-7.638-7.234-.973-.73-1.976-1.3-3-1.6C58.3 20.7 66.03 32.432 62.8 38.06zm-49.768 5.166c.397-.097.902-.073 1.558.116 2.367 1.373 3.977 3.13 5.477 4.955-1.714 2.342-2.345 4.868-2.572 8.34-2.847-1.034-7.672-12.62-4.463-13.4zm34.968-6.154c.67-.25 1.412-.072 2.093.353s1.355 1.152 1.983 1.996c1.257 1.688 2.417 4.084 3.285 6.907s1.228 5.5 1.16 7.674c-.034 1.092-.117 2.103-.423 2.898s-.798 1.442-1.468 1.693-1.412.072-2.093-.353-1.355-1.152-1.983-1.996c-1.257-1.688-2.467-4.07-3.334-6.893s-1.228-5.5-1.16-7.674c.034-1.092.166-2.117.472-2.912s.798-1.442 1.468-1.693zm-22.56 7.262a9.24 9.24 0 0 0-1.951.829c3.188-.23 6.43 1.05 9.16 3.47 3.285 2.915 5.94 7.398 7.306 12.773.876 3.448 1.132 6.87.802 9.998 1.732-3.773 2.22-8.693.942-13.713-2.347-9.23-9.643-15.224-16.258-13.356zm23.134-5.423c-.26.097-.485.358-.678.858s-.32 1.24-.348 2.154c-.056 1.826.275 4.32 1.074 6.92s1.915 4.864 2.966 6.275c.526.706 1.04 1.152 1.468 1.42s.745.313 1.004.217.485-.358.678-.858.333-1.2.362-2.103c.056-1.826-.337-4.358-1.136-6.958s-1.888-4.76-2.94-6.17C50.5 39.96 50 39.396 49.57 39.13s-.745-.313-1.004-.217z"/><path d="M37.232 41.8c7.9-.404 16.935-.404 16.935-.404s21.775 0 27.22 1.5c2.98.846 5.33 3.322 6.132 6.524 1.433 5.738 1.433 17.638 1.433 17.638s0 11.96-1.433 17.638c-.86 3.2-3.152 5.678-6.2 6.524-14.7-16.467-33.073-20.255-44.097-49.42z" fill="red"/><path d="M45.084 56.084l18.108 10.993L45.084 78.07z" fill="#fff"/><path d="M242.594 88.093c-2.133-.532-4.637-2.42-5.724-4.287-.516-.885-1.22-2.925-1.565-4.53-.57-2.66-.617-3.844-.526-13.312.102-10.374.103-10.396.963-12.9 1.76-5.105 4.497-7.104 9.725-7.104 3.038 0 3.348.085 5.3 1.46 3.013 2.1 4.394 5.206 4.952 11.1l.198 2.074h-6.8v-1.78c0-4.32-4.563-6.447-6.85-3.2-1.05 1.494-1.193 3.2-1.07 12.865.087 6.93.18 8.25.662 9.292 1.273 2.762 4.68 3.137 6.4.705.728-1.037.87-1.602.87-3.456v-2.2h6.82l-.202 2.5c-.48 5.958-2.467 10.212-5.538 11.847-1.928 1.026-5.53 1.462-7.637.923zM267.56 56.48c-4.388-.026-7.546 2.832-8.396 7.686l-.312 1.793h5.307l.32-1.172c.4-1.428 1.55-2.437 2.8-2.44 1.914-.003 2.652 1.017 2.852 3.94l.127 1.865-2.44 1.074c-4.728 2.1-7.78 4.765-8.9 7.8-.56 1.53-.767 5.512-.367 7.115.558 2.245 1.826 3.664 3.723 4.172l-.016-.008c1.315.352 1.736.333 3.252-.14 1.43-.447 3.338-1.742 3.906-2.65.406-.653.756-.373.756.627 0 1.734.124 1.814 2.8 1.814h2.5l-.07-12.23c-.08-13.723-.15-14.382-1.727-16.422-1.305-1.687-2.978-2.574-5.248-2.78a10.93 10.93 0 0 0-.895-.043zm2.252 16.56c.444.093.385 1.108.385 3.55v3.77l-.928.965c-.5.54-1.172 1.133-1.47 1.34v.002c-.297.206-1.085.377-1.75.377-1.988 0-2.908-1.887-2.168-4.457.472-1.64 1.535-2.877 3.717-4.324 1.218-.808 1.868-1.293 2.213-1.22zm16.396 15.255c-2.656-.624-4.512-2.62-6.093-6.556-.586-1.46-.712-2.025-.473-2.13.855-.376 4.098-1.494 4.333-1.494.147 0 .342.397.434.883.705 3.73 5.095 5.198 6.082 2.036.7-2.243-.252-3.693-4.116-6.27-4.74-3.162-6.13-5.34-6.13-9.618 0-4.092 1.593-6.876 4.637-8.104 4.138-1.668 8.2.517 10.164 5.468l.648 1.633-2.05 1.064c-1.128.585-2.123 1.07-2.212 1.076s-.455-.65-.814-1.463c-.76-1.724-1.694-2.464-3.105-2.464-1.28 0-2.227 1.123-2.227 2.644 0 1.445.958 2.524 4.186 4.716 4.94 3.354 6.304 5.468 6.304 9.762 0 4.02-1.958 7.498-4.763 8.462-1.456.5-3.535.654-4.805.356zm17.56-.015c-1.424-.318-2.545-1.144-3.246-2.4-.497-.884-.526-1.402-.644-11.328l-.124-10.4-2.102-.202v-5.544h2.226V49.88h5.18l.14 8.373 3.587.193v5.524l-3.587.193v8.282c0 9.587-.03 9.464 2.3 9.83l1.286.202v5.727l-1.3.207c-1.536.245-2.138.224-3.715-.128zm16.282-31.805c-.88-.001-1.782.148-2.687.46-2.33.805-3.976 2.5-5.076 5.256l-.658 1.64v8.537c0 7.987.033 8.633.52 10.03 1.064 3.052 3.122 5.138 5.8 5.88l.004.002c1.54.427 4.5.1 6.04-.67 2.292-1.14 4.027-4.16 4.46-7.773l.166-1.396h-2.742c-2.6 0-2.744.036-2.744.674 0 2.85-2.856 4.585-4.87 2.955-1.12-.905-1.366-1.724-1.506-5.004l-.125-2.893h11.94V69.8c0-2.964-.12-4.918-.377-6.06-.995-4.45-4.336-7.264-8.145-7.268zm.082 5.88c1.032 0 1.4.166 2.047.936.7.82.804 1.2.9 2.955l.008-.002.102 2.02h-6.555l.164-1.656c.32-3.187 1.154-4.254 3.334-4.254zm13.138 10.178v-15.43h5.442v4.104l.462-.985c1-2.152 3.004-3.776 4.637-3.776.584 0 .587.02.587 3.812v3.812l-.928-.276c-.5-.152-1.455-.278-2.1-.28-.95-.003-1.3.166-1.855.904l-.684.908-.142 22.64h-5.423z"/></svg>
</div>
<small>paste youtube link and listen in background!</small>
<br />
<input id="url" type="text" placeholder="paste link here" value="" />
<div id="err"></div>
<br />
<div class="playing">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="margin:auto;background:#fff;display:block;" width="50px" height="50px" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid">
<circle cx="18" cy="50" r="4" fill="#e15b64">
  <animate attributeName="cy" values="34;66;34" times="0;0.5;1" dur="1s" calcMode="spline" keySplines="0.5 0 0.5 1;0.5 0 0.5 1" begin="0s" repeatCount="indefinite"></animate>
</circle><circle cx="27" cy="61.31370849898476" r="4" fill="#f47e60">
  <animate attributeName="cy" values="34;66;34" times="0;0.5;1" dur="1s" calcMode="spline" keySplines="0.5 0 0.5 1;0.5 0 0.5 1" begin="-0.125s" repeatCount="indefinite"></animate>
</circle><circle cx="36" cy="66" r="4" fill="#f8b26a">
  <animate attributeName="cy" values="34;66;34" times="0;0.5;1" dur="1s" calcMode="spline" keySplines="0.5 0 0.5 1;0.5 0 0.5 1" begin="-0.25s" repeatCount="indefinite"></animate>
</circle><circle cx="45" cy="61.31370849898476" r="4" fill="#abbd81">
  <animate attributeName="cy" values="34;66;34" times="0;0.5;1" dur="1s" calcMode="spline" keySplines="0.5 0 0.5 1;0.5 0 0.5 1" begin="-0.375s" repeatCount="indefinite"></animate>
</circle><circle cx="54" cy="50" r="4" fill="#e15b64">
  <animate attributeName="cy" values="34;66;34" times="0;0.5;1" dur="1s" calcMode="spline" keySplines="0.5 0 0.5 1;0.5 0 0.5 1" begin="-0.5s" repeatCount="indefinite"></animate>
</circle><circle cx="63" cy="38.68629150101524" r="4" fill="#f47e60">
  <animate attributeName="cy" values="34;66;34" times="0;0.5;1" dur="1s" calcMode="spline" keySplines="0.5 0 0.5 1;0.5 0 0.5 1" begin="-0.625s" repeatCount="indefinite"></animate>
</circle><circle cx="72" cy="34" r="4" fill="#f8b26a">
  <animate attributeName="cy" values="34;66;34" times="0;0.5;1" dur="1s" calcMode="spline" keySplines="0.5 0 0.5 1;0.5 0 0.5 1" begin="-0.75s" repeatCount="indefinite"></animate>
</circle><circle cx="81" cy="38.68629150101523" r="4" fill="#abbd81">
  <animate attributeName="cy" values="34;66;34" times="0;0.5;1" dur="1s" calcMode="spline" keySplines="0.5 0 0.5 1;0.5 0 0.5 1" begin="-0.875s" repeatCount="indefinite"></animate>
</circle>
</svg>
</div>
<button id="play">play</button>
<button id="pause">pause</button>
<br />
<br />
<ul id="list">
</ul>

<audio id="audio" src=""></audio>

<script src="https://unpkg.com/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://unpkg.com/handlebars@4.6.0/dist/handlebars.min.js"></script>

<script id="list-items" type="text/x-handlebars-template">
{{#each items}}
	<li data-url="{{url}}" title="{{title}}">
		<img src="{{thumbnail}}" />
	  	<span>{{title}}</span> <small>{{duration}}</small>
	  	<span class='bar'></span>
	</li>
{{/each}}
</script>
<script>
var url$ = $('#url');
var audio$ = $('#audio');
var err$ = $('#err');
var tmplItems = Handlebars.compile($('#list-items').html());

window.app = {
	errt: null,
	mode: 'video',//or 'playlist'
	err: function(m) {
		err$.text(m);
		clearTimeout(app.errt);
		app.errt = setTimeout(()=>{
			err$.text('')
		},3000);
	}
};

audio$.on('playing', function(e) {
	$('.playing').css('visibility','visible');
	
	var url = audio$.attr('src').split('url=')[1];

	$('#list li').removeClass('play');
	$('#list li[data-url="'+url+'"]').addClass('play')
})
.on('ended', function(e) {
	console.log('play end');
	var next$ = $('#list li.play').next('li');
	if(app.mode==='playlist' && next$.length) {
		next$.trigger('click');
	}
	$('.playing').css('visibility','hidden');
	$('#list li').removeClass('play');
});

$('#play').on('click', function(e) {
	try {
	var url = new URL($.trim($('#url').val()));
	}catch(err) {
		app.err(err.message)
	}
	if($('#list li').length==0) {
		if(url.pathname=='/playlist') {
			
			app.mode = 'playlist';

			$.getJSON(location.origin+'/playlist?url='+url, (json)=> {
				
				if(json.err){
					app.err(json.err);
				}
				else if(json.items.length)
					$('#list').html(tmplItems(json));
			});
		}
		else if(url.pathname=='/watch' || url.hostname=='youtu.be') {

			app.mode = 'video';

			$.getJSON(location.origin+'/video?url='+url, (json)=> {

				if(json.err) {
					app.err(json.err)
				}
				else
					$('#list').html(tmplItems({items: [json]}));
			});
		}
		else
			app.err('it is not a youtube link')
	}

	$('#list li').first().trigger('click');
});

$('#pause').on('click', function(e) {
	audio$[0].pause();
});

$('#list').on('click','li', function(e) {
	var li$ = $(e.currentTarget),
		url = li$.data('url')
	audio$.attr('src', location.origin+'/stream?url=' + url);
	audio$[0].play();
})

async function paste(input) {
  const text = await navigator.clipboard.readText();
  if(text.substr(0,4)=='http')
  	input.value = text;
}

url$.on('focus', function(e) {
	paste(this);
	setTimeout(()=> {
		$('#play').trigger('click');
	},100)
});

//DEBUG
if(location.hash=='#debug')
setTimeout(()=>{
var lis = "https://www.youtube.com/playlist?list=PL-g83uREdYKIfm3mZOHpEKrQK10gaLZgH";
var vid = "https://www.youtube.com/watch?v=Vm55LE4V3kY"
url$.val(vid).trigger('focus')
},100)

</script> 
</body>
</html>

